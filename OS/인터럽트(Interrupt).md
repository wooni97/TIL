# 인터럽트

## 인터럽트(Interrupt)

### **인터럽트(Interrupt)란?**

프로그램을 실행하는 도중에 예기치 않은 상황이 발생할 경우(입출력 하드웨어 등의 장치 or 예외 상황), 현재 실행 중인 작업을 즉시 중단하고, 발생된 상황에 대한 우선 처리가 필요함을 CPU에게 알리는 것이다.

### **입출력 장치에서 인터럽트를 왜 하는것일까?**

입출력 연산이 CPU 명령 수행속도보다 현저히 느리기 때문이다. 입출력 연산을 CPU가 매번 기다린다면 CPU를 백분 활용하지 못하게 된다. 다른 일을 하다가 입출력 연산이 CPU에게 작업 완료를 알려주는 것이 인터럽트이다.

---

### 인터럽트 분류

*인터럽트가 어디서 발생하느냐로 구분*



> **하드웨어 인터럽트**
>

하드웨어가 발생시키는 인터럽트로, 입출력 치와 같이 외부의 돌발적인 상황이 발생하였을 경우 CPU에게 알려주거나 서비스를 요청한다. CPU는 실행중인 작업들을 일시 중단하고 정해진 인터럽트 작업을 수행한다.

> **소프트웨어 인터럽트**
>

CPU 외부에서 발생하는 인터럽트와는 달리 CPU 내부에서 발생하는 신호들이다. instruction을 실행하다가 만나게 되는 문제점들에 대해서 CPU가 스스로 발생시키는 신호이다.(보통 예외라고도 명시함)

에러나 커널이 처리해야할 비정상적인 상황에 CPU가 대처하기 위한 작업들이다.

- exception : CPU가 명령어를 실행하다가 비정상적인 상황을 감지할 때 발생한다.
- fault : 발생한 사건을 복구하고 다시 재시작할 수 있는 상황에서 발생한다. ex) page fault
- trap: 트랩을 발생시키는 명령어를 실행하자마자 발생한다. 프로그램은 커널로부터 제어권을 다시 돌려 받은 후에 이어서 실행할 수 있다. ex) 디버깅 할 때 breaking point
- abort : 심각한 에러 (하드웨어 고장, 시스템 테이블에 잘못된 값이 들어가 있는 경우)로 인하여 더이상 진행이 될 수 없는 상황에서 발생한다. 문제가 발생한 프로세스를 강제로 종료해야만 하는 상황이다.

[인터럽트 종류와 처리과정과 우선순위](https://medium.com/@lazypanda43/인터럽트-종류와-처리과정과-우선순위-c95c26909472)

---

### 인터럽트 처리

> **인터럽트의 처리 시기**
>
- 하드웨어 인터럽트는 현재 명령어 실행을 마친 후 처리된다
- 트랩은 실행중에 처리되므로, 오류의 경우 프로그램의 종료를 가져온다.
- 시스템 콜은 입출력이 완료되어야 실행 중인 명령어가 완료되고 다음 실행문으로 진행한다.

> **인터럽트 처리 과정**
>

![Untitled (1).png](..%2FUntitled%20%281%29.png)

CPU가 인터럽트를 확인하면 인터럽트 처리 루틴을 실행시킨다. 그 전에 현 상태의 정보(레지스터 값)를 시스템 스택에 저장한다. 인터럽트 처리 루틴의 시작 주소를 PC에 넣고 실행한다. 루틴 실행이 끝나면 레지스터에 값을 복원하고, 프로그램의 실행을 계속 이어나간다.

1. 인터럽트 발생 : 하드웨어나 소프트웨어에서 인터럽트가 발생한다.
2. 현재 작업 중단 : 운영체제는 현재 실행 중인 작업을 중단시키고, 중단된 작업의 상태를 해당 프로세스의 PCB에 저장한다. 이는 프로세서의 상태 레지스터, 프로그램 카운터 등의 정보를 저장하는것을 포함한다.
3. 다음 실행할 명령어 주소 저장 : PC에 다음에 실행할 명령어 주소를 저장한다.
4. 인터럽트 서비스 루틴 실행 : 인터럽트 벡터를 읽고 ISR 주소값을 얻어 인터럽트 서비스 루틴(Interrupt Service Routine, ISR)이 실행된다. ISR은 해당 인터럽트에 대한 처리를 담당하는 코드다. 운영체제는 인터럽트의 종류에 따라 적절한 ISR을 실행한다.

   *(*인터럽트 벡터 : 인터럽트 발생시 처리해야 할 인터럽트 핸들러의 주소를 인터럽트 별로 보관하고 있는 테이블)*

5. 인터럽트 처리 : ISR은 해당 인터럽트에 대한 처리를 수행한다. ISR이 실행되는 동안에는 인터럽트가 다시 발생하지 않도록 인터럽트 비활성화 상태로 전환된다.
6. 이전 작업으로 복귀 : ISR이 실행은 완료하면, IRET 명령어에 의해 인터럽트가 해제 된다. IRET 명령어가 실행되면 이전에 중단된 작업으로 복귀한다. 이를 위해 운영체제는 저장된 작업의 상태를 복원하고, 프로그램 카운터를 이전 위치로 되돌린다.

### **동시에 두개 이상의 인터럽트가 발생하면**

여러장치에서 인터럽트가 동시에 발생하거나, 인터럽트 서비스 루틴 수행중 인터럽트가 발생했을 경우 우선순위를 따져서 처리한다.

- 일반적으로 하드웨이 인터럽트가 소프트웨어 인터럽트보다 우선순위가 높다
- 내부 인터럽트보다 외부 인터럽트 우선순위가 높다

### 우선순위 판별 방법

> 폴링
>
- 소프트웨어적인 방법
- 주기적으로 인터럽트가 있는지 확인한다.
- 인터럽트 요청 플래그를 차례로 비교하여 우선순위가 가장 높은 인터럽트 자원을 찾아 이에 맞는 인터럽트 서비스 루틴을 수행한다.
- 많은 인터럽트가 있을 경우, 모두 조사하는 데에 시간이 걸려 처리 속도가 느림
- 별도의 하드웨어가 필요 없어서 경제적이다.

> 인터럽트 방식
>
- 하드웨어적인 방법
- 인터럽트 발생 시, 해당하는 인터럽트 벡터를 찾아 인터럽트 서비스 수행
- 추가적인 하드웨어가 필요하므로 비경제적이나 별도의 프로그램 루틴이 없어 응답 속도가 빠르다.
- Daisy Chain 방식
    - 인터럽트가 발생하는 모든 장치를 하나의 직렬 회선으로 연결
    - 우선순위가 높은 장치를 상위에 두고 차례대로 배치
- 병렬 우선순위 부여 방식
    - 인터럽트가 발생하는 모든 장치를 하나의 병렬 회선으로 연결
    - 각 장치별 우선순위를 판별하기 위해 Mask Register에 bit를 설정
    - Mask Register는 우선순위가 높은 것이 서비스를 받고 있을 때, 우선순위가 낮은것을 비활성화 할 수 있음
    - 우선 순위가 높은 인터럽트는 낮은 인터럽트가 처리되는 중에도 우선적으로 처리됨