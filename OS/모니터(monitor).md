# 모니터(Monitor)

## 모니터(monitor)

---

세마포어는 동시성 문제를 해결하는데 유용하지만 프로그래머가 올바르게 사용하지 않으면 타이밍 문제가 발생할 수 있다.

- 타이밍 문제란 타이밍에 따라 문제가 발생할 수도 발생하지 않을 수도 있는 것을 의미. → 대처하기 까다롭고 디버깅에 어려움을 줌

이러한 타이밍 문제를 해결하기 위해 모니터라는 기법이 개발되었다. 세마포어는 프로그래머가 signal, wait 함수를 사용해서 동기화를 구현해야 하는 반면 모니터는 내부에서 동기화를 관리해주기 때문에 사용방법이 간단하다.

- 추가 설명 : 세마포어의 문제점

  일단 세마포어의 개념부터 설명하자면 세마포어는 하나 이상의 스레드가 공유 자원에 접근하도록 할 수 있다. 값을 올리고 내리는 방식으로 사용하는데, 이를 자세히 살펴보자면 특정 자원에 접근할때 semWait라는 함수가 호출되게 된다. 이 함수는 임계 구역에 들어갈 수 있는지 확인하는 함수인데, semWait 연산은 세마포어의 값을 감소시켜서 만약 값이 음수가 된다면 semWait를 호출한 스레드는 블록되지만 음수가 아니라면 스레드는 작업을 수행할 수 있다.

  반대로 semSignal 연산은 세마포어의 값을 증가 시킨다.

  이러한 세마포어에서는 타이밍 문제가 발생할 수 있는데, 스레드가 동시에 semWait를 호출하게 된다면 서로 대기 상태로 다른 쪽에서 signal을 호출하기 전까지 기다리게 도니다.


### 모니터 정의

모니터는 프로세스 간의 상호 배제를 달성하기 위해 프로그래밍 언어 수준에서 제공되는 동기화 도구이다.

Java 및 C#등은 해당 언어로 내장된 모니터를 제공한다.

- Java - Synchronized 키워드
- C# - lock 키워드

### 모니터 구조

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/0747e310-4032-4588-a306-7faef82d958b/86dbf68e-7c59-4077-96cb-adcba03502f3/Untitled.png)

모니터는 **공유 자원 + 공유 자원 접근함수 + 두개의 큐로** 이루어져있다. 공유 자원 접근 함수는 공유 자원을 다루는 연산들이다.

큐는 각각

- **Mutual Exclusion Queue(상호 배타 큐)** : 공유 자원에 하나의 프로세스만 진입하도록 위한 큐
- **Conditional Synchronization Queue(조건 동기 큐)** : 공유자원을 사용하고 있는 프로세스가 특정한 호출 wait()을 통해 조건동기 큐로 들어갈 수 있다.

최대 한개의 프로세스/스레드만 모니터 개체 내에 공유 자원에 접근 함수에 들어갈 수 있고, 그 이상 들어가려고 하면 상호배타 큐에서 대기하게 된다.

모니터 개체 내 공유 자원은 직접 접근할 수 없고 접근 함수를 통해서만 가능하다.(정보은닉)

### 조건 변수

공유 자원에 대한 접근을 조율하는데 사용되는 동기화 기법 중 하나로, 조건 변수는 특정 조건이 충족되기를 기다리는 프로세스를 표현하는데 사용된다.

모니터에서 사용하는 특수한 유형의 데이터 타입으로, 모니터에서 공유 자원에 대한 접근을 조율하는데 사용되는 동기화 기법이다.

모니터 내부에서 조건 변수는 크게 두 가지 기능을 수행한다.

**wait**

- 프로세스가 조건 c에서 해당 조견변수를 사용하여 대기 상태로 들어갈 때 호출한다.
- 다른 프로세스가 signal() 함수를 호출할 때까지 차단되고 차단된 프로세스는 해당 조건과 관련된 큐에서 대기

**signal**

- 다른 프로세스가 조건 c의 변화를 발견했을 때 호출한다.
- 조건 변수에 대해 신호를 보내면 wait에 의해 중지되었던 프로세스 중 하나를 깨운다.

### 식사하는 철학자 문제 : 모니터 해결안